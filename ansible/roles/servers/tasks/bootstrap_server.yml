---
- hosts: all
  become: true

  tasks:
    - name: Install aptitude using apt
      apt: name=aptitude state=latest update_cache=yes force_apt_get=yes

    - name: Install required system packages
      apt: name={{ item }} state=latest update_cache=yes
      loop: [ 'apt-transport-https', 'ca-certificates', 'curl', 'python3-pip', 'virtualenv', 'python3-setuptools', 'rpm']

    - name: Add Docker GPG apt Key
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present

    - name: Add Docker Repository
      apt_repository:
        repo: deb https://download.docker.com/linux/ubuntu bionic stable
        state: present

    - name: Update apt and install docker.io
      apt: update_cache=yes name=docker.io state=latest

    - name: Make sure Docker service is running and set to automatically start on boot
      systemd:
        state: started
        name: docker
        enabled: yes

    - name: Install Docker Compose Module for Python
      pip:
        name: docker-compose

    - name: Install Docker Module for Python
      pip:
        name: docker

    - name: Install JmesPath Module for Python
      pip:
        name: jmespath

  roles:
    - role: ansible-netplan
      become: yes
      # This role will do nothing unless netplan_enabled is true.
      netplan_enabled: true
      # The default is /etc/netplan/config.yaml.
      netplan_config_file: /etc/netplan/udf-netplan.yaml
      # Ubuntu 18.04, for example, defaults to using networkd.
      netplan_renderer: networkd
      # Simple network configuration to add a single network
      # interface.
      netplan_configuration:
        network:
          version: 2
          ethernets:
            eth1:
              dhcp4: false
              addresses:
                - 10.1.20.11/24
              gateway4: 10.1.20.1